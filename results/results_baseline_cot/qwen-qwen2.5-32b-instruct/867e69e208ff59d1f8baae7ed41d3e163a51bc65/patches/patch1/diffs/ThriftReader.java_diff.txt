1,15d0
< /**
<  * Copyright 2019 Pinterest, Inc.
<  * 
<  * Licensed under the Apache License, Version 2.0 (the "License");
<  * you may not use this file except in compliance with the License.
<  * You may obtain a copy of the License at
<  * 
<  *    http://www.apache.org/licenses/LICENSE-2.0
<  * 
<  * Unless required by applicable law or agreed to in writing, software
<  * distributed under the License is distributed on an "AS IS" BASIS,
<  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<  * See the License for the specific language governing permissions and
<  * limitations under the License.
<  */
25a11
> import org.apache.thrift.transport.TTransportFactory;
63,64c49,50
<   // The framed framedTransport.
<   private final TFramedTransport framedTransport;
---
>   // TTransport implementation.
>   private final TTransport transport;
80,81c66,67
<     this.framedTransport = new TFramedTransport(new TIOStreamTransport(this
<         .byteOffsetInputStream), maxMessageSize);
---
>     TTransportFactory transportFactory = new TFramedTransport.Factory();
>     this.transport = transportFactory.getTransport(new TIOStreamTransport(this.byteOffsetInputStream));
83c69
<     this.protocol = protocolFactory.get(this.framedTransport);
---
>     this.protocol = protocolFactory.get(this.transport);
95c81
<     if (framedTransport.getBytesRemainingInBuffer() == 0 && byteOffsetInputStream.isEOF()) {
---
>     if (transport.getBytesRemainingInBuffer() == 0 && byteOffsetInputStream.isEOF()) {
110,111c96,97
<         byteOffsetInputStream.getByteOffset() >= framedTransport.getBytesRemainingInBuffer());
<     return byteOffsetInputStream.getByteOffset() - framedTransport.getBytesRemainingInBuffer();
---
>         byteOffsetInputStream.getByteOffset() >= transport.getBytesRemainingInBuffer());
>     return byteOffsetInputStream.getByteOffset() - transport.getBytesRemainingInBuffer();
127c113
<     framedTransport.consumeBuffer(framedTransport.getBytesRemainingInBuffer());
---
>     transport.consumeBuffer(transport.getBytesRemainingInBuffer());
139c125
<     framedTransport.close();
---
>     transport.close();
