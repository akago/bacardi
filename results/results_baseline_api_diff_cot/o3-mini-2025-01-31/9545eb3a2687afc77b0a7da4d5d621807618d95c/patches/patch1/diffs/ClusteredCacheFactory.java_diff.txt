22d21
< import com.hazelcast.config.MaxSizeConfig;
27c26,28
< import com.hazelcast.core.Cluster;
---
> import com.hazelcast.config.EvictionConfig;
> import com.hazelcast.cluster.Cluster;
> import com.hazelcast.cluster.Member;
30d30
< import com.hazelcast.core.Member;
44c44
< import org.jivesoftware.util.cache.CacheFactory;
---
> import org.jivesoftware.openfire.plugin.util.cache.CacheFactory;
288c288,290
<             dynamicConfig.setMaxSizeConfig(new MaxSizeConfig(hazelcastMaxCacheSizeInMegaBytes, MaxSizeConfig.MaxSizePolicy.USED_HEAP_SIZE));
---
>             dynamicConfig.getEvictionConfig()
>                 .setSize(hazelcastMaxCacheSizeInMegaBytes)
>                 .setMaximumSizePolicy(EvictionConfig.MaxSizePolicy.USED_HEAP_SIZE);
294d295
<         // TODO: Better genericize this method in CacheFactoryStrategy so we can stop suppressing this warning
371a373
>         String currentNodeId = (String) current.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
373c375,376
<             if (!member.getUuid().equals(current.getUuid())) {
---
>             String memberNodeId = (String) member.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
>             if (!memberNodeId.equals(currentNodeId)) {
378d380
< 
424a427
>         String currentNodeId = (String) current.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
426c429,430
<             if (includeLocalMember || (!member.getUuid().equals(current.getUuid()))) {
---
>             String memberNodeId = (String) member.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
>             if (includeLocalMember || (!memberNodeId.equals(currentNodeId))) {
548d551
<         // TODO: Update CacheFactoryStrategy so the signature is getLock(final Serializable key, Cache<Serializable, Serializable> cache)
566d568
<             // Try to determine what plugin loaded the offending class.
583c585
<             pluginClassLoaderWarnings.put(o.getClass().getName(), Instant.now()); // Note that this Instant is unused.
---
>             pluginClassLoaderWarnings.put(o.getClass().getName(), Instant.now());
656c658,659
<         return NodeID.getInstance(member.getStringAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE).getBytes(StandardCharsets.UTF_8));
---
>         String nodeIdAttr = (String) member.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
>         return NodeID.getInstance(nodeIdAttr.getBytes(StandardCharsets.UTF_8));
699d701
< 
701,703d702
< 
< 
< 
