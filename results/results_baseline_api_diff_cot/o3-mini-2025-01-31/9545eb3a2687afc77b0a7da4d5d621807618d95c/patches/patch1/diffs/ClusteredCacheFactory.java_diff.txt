22d21
< import com.hazelcast.config.MaxSizeConfig;
25d23
< import com.hazelcast.config.NetworkConfig;
27c25,28
< import com.hazelcast.core.Cluster;
---
> import com.hazelcast.config.EvictionConfig;
> import com.hazelcast.config.EvictionConfig.MaxSizePolicy;
> import com.hazelcast.cluster.Cluster;
> import com.hazelcast.cluster.Member;
30d30
< import com.hazelcast.core.Member;
44c44
< import org.jivesoftware.util.cache.CacheFactory;
---
> import org.jivesoftware.openfire.util.cache.CacheFactory;
186c186
<                 final NetworkConfig networkConfig = config.getNetworkConfig();
---
>                 final com.hazelcast.config.NetworkConfig networkConfig = config.getNetworkConfig();
194,195c194,195
<                 memberAttributeConfig.setStringAttribute(HazelcastClusterNodeInfo.HOST_NAME_ATTRIBUTE, XMPPServer.getInstance().getServerInfo().getHostname());
<                 memberAttributeConfig.setStringAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE, XMPPServer.getInstance().getNodeID().toString());
---
>                 memberAttributeConfig.setAttribute(HazelcastClusterNodeInfo.HOST_NAME_ATTRIBUTE, XMPPServer.getInstance().getServerInfo().getHostname());
>                 memberAttributeConfig.setAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE, XMPPServer.getInstance().getNodeID().toString());
288c288,289
<             dynamicConfig.setMaxSizeConfig(new MaxSizeConfig(hazelcastMaxCacheSizeInMegaBytes, MaxSizeConfig.MaxSizePolicy.USED_HEAP_SIZE));
---
>             dynamicConfig.getEvictionConfig().setMaximumSizePolicy(MaxSizePolicy.USED_HEAP_SIZE);
>             dynamicConfig.getEvictionConfig().setSize(hazelcastMaxCacheSizeInMegaBytes);
294,295c295,296
<         // TODO: Better genericize this method in CacheFactoryStrategy so we can stop suppressing this warning
<         @SuppressWarnings("unchecked") final ClusteredCache clusteredCache = new ClusteredCache(name, hazelcast.getMap(name));
---
>         @SuppressWarnings("unchecked")
>         final ClusteredCache clusteredCache = new ClusteredCache(name, hazelcast.getMap(name));
378d378
< 
548,549c548,549
<         // TODO: Update CacheFactoryStrategy so the signature is getLock(final Serializable key, Cache<Serializable, Serializable> cache)
<         @SuppressWarnings("unchecked") final ClusterLock clusterLock = new ClusterLock((Serializable) key, (ClusteredCache<Serializable, ?>) cache);
---
>         @SuppressWarnings("unchecked")
>         final ClusterLock clusterLock = new ClusterLock((Serializable) key, (ClusteredCache<Serializable, ?>) cache);
583c583
<             pluginClassLoaderWarnings.put(o.getClass().getName(), Instant.now()); // Note that this Instant is unused.
---
>             pluginClassLoaderWarnings.put(o.getClass().getName(), Instant.now());
656c656,657
<         return NodeID.getInstance(member.getStringAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE).getBytes(StandardCharsets.UTF_8));
---
>         String nodeAttr = (String) member.getAttribute(HazelcastClusterNodeInfo.NODE_ID_ATTRIBUTE);
>         return NodeID.getInstance(nodeAttr.getBytes(StandardCharsets.UTF_8));
701,703d701
< 
< 
< 
