24,25d23
< import org.apache.thrift.transport.TFramedTransport;
< import org.apache.thrift.transport.TIOStreamTransport;
26a25
> import org.apache.thrift.transport.TIOStreamTransport;
45c44
<   private static final class ByteOffsetTFramedTransport extends TFramedTransport {
---
>   private static final class ByteOffsetTFramedTransport extends TTransport {
47a47
>     private final TTransport transport;
50c50
<       super(transport);
---
>       this.transport = transport;
56c56
<       super.write(buf, off, len);
---
>       transport.write(buf, off, len);
62c62
<       super.flush();
---
>       transport.flush();
64c64,66
<       byteOffset += 4;
---
>       // This is incorrect, as TFramedTransport writes the frame size before the data.
>       // We should not add 4 here.
>       // byteOffset += 4;
69a72,96
> 
>     @Override
>     public boolean isOpen() {
>       return transport.isOpen();
>     }
> 
>     @Override
>     public boolean peek() {
>       return transport.peek();
>     }
> 
>     @Override
>     public void open() throws TTransportException {
>       transport.open();
>     }
> 
>     @Override
>     public void close() {
>       transport.close();
>     }
> 
>     @Override
>     public int read(byte[] buf, int off, int len) throws TTransportException {
>       return transport.read(buf, off, len);
>     }
