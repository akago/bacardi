28d27
< import org.apache.commons.io.input.BoundedInputStream;
204,206c203,213
<                         BoundedInputStream bis = new BoundedInputStream( in, remainingSpace + 1 );
<                         CountingInputStream cis = new CountingInputStream( bis );
<                         extractFile( getSourceFile(), outputDirectory, cis,
---
>                         CountingInputStream cis = new CountingInputStream( in );
>                         long bytesRead = 0;
>                         byte[] buffer = new byte[8192];
>                         int bytesReadThisTime;
>                         while ( (bytesReadThisTime = cis.read(buffer)) != -1 ) {
>                             bytesRead += bytesReadThisTime;
>                             if ( bytesRead > remainingSpace ) {
>                                 throw new ArchiverException( "Maximum output size limit reached" );
>                             }
>                         }
>                         extractFile( getSourceFile(), outputDirectory, in,
211,215c218
<                         remainingSpace -= cis.getByteCount();
<                         if ( remainingSpace < 0 )
<                         {
<                             throw new ArchiverException( "Maximum output size limit reached" );
<                         }
---
>                         remainingSpace -= bytesRead;
