6c6,8
< import java.nio.file.*;
---
> import java.nio.file.Files;
> import java.nio.file.Path;
> import java.nio.file.StandardOpenOption;
42d43
< 
228,242c229,238
<                         segmentListFile.deleteOnExit(); // Delete if OCR4all terminates
<                         ObjectMapper mapper = new ObjectMapper();
<                         ArrayNode dataList = mapper.createArrayNode();
<                         for (String pageId : pageIds) {
<                                 ArrayNode pageList = mapper.createArrayNode();
<                                 pageList.add(projConf.getImageDirectoryByType(projectImageType) + pageId +
<                                                 projConf.getImageExtensionByType(projectImageType));
<                                 final String pageXML = projConf.OCR_DIR + pageId + projConf.CONF_EXT;
<                                 pageList.add(pageXML);
< 
<                                 // Add affected line segment images with their absolute path to the json file
<                                 dataList.add(pageList);
<                         }
<                         ObjectWriter writer = mapper.writer();
<                         writer.writeValue(segmentListFile, dataList);
---
>                         skewparams.add("--data.output_dir");
>                         skewparams.add(segmentListFile.getParent());
>                         skewparams.add("--data.output_format");
>                         skewparams.add("json");
>                         skewparams.add("--data.output_file");
>                         skewparams.add(segmentListFile.getName());
>                         skewparams.add("--data.images");
>                         skewparams.add(segmentListFile.toString());
>                         skewparams.add("--data.gt");
>                         skewparams.add(segmentListFile.toString());
251d246
< 
292d286
<         command.add(segmentListFile.toString());
294,320c288,291
<         //Add checkpoints
<         Iterator<String> cmdArgsIterator = cmdArgsWork.iterator();
<         while (cmdArgsIterator.hasNext()) {
<             String arg = cmdArgsIterator.next();
<             command.add(arg);
<             if (arg.equals("--checkpoint") && cmdArgsIterator.hasNext()) {
<                 command.addAll(extractModelsOfJoinedString(cmdArgsIterator.next()));
<             }
<         }
< 
<         command.add("--data");
<         command.add("PageXML");
<         // Set output extension to input extension in order to overwrite the original file
<         // (default would've been .pred.xml)
<         command.add("--data.gt_extension");
<         command.add(".xml");
<         command.add("--data.pred_extension");
<         command.add(".xml");
< 
<         command.add("--data.text_index");
<         command.add("1");
< 
<         command.add("--verbose");
<         command.add("True");
< 
<         command.add("--predictor.progress_bar");
<         command.add("False");
---
>         ObjectMapper mapper = new ObjectMapper();
>         ObjectWriter writer = mapper.writer();
>         Path path = segmentListFile.toPath();
>         writer.writeValue(path, content);
448,449d418
<      * Example: /var/ocr4all/models/custom/Bibel/heading/0.ckpt.json
<      * Display: Bibel/heading/0
465,472c434,438
<         Files.walk(Paths.get(ProjectConfiguration.PROJ_MODEL_DIR), FileVisitOption.FOLLOW_LINKS)
<         .map(Path::toFile)
<         .filter(fileEntry -> fileEntry.getName().endsWith(ProjectConfiguration.MODEL_EXT))
<         .forEach(
<             fileEntry -> {
<                 // Remove OS path and model extension from display string (only display significant information)
<                 String modelName = fileEntry.getAbsolutePath();
<                 modelName = modelName.replace(ProjectConfiguration.PROJ_MODEL_DEFAULT_DIR, "");
---
>         Files.walkFileTree(Paths.get(ProjectConfiguration.PROJ_MODEL_DIR), new SimpleFileVisitor<Path>() {
>             @Override
>             public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
>                 if (file.getFileName().toString().endsWith(ProjectConfiguration.MODEL_EXT)) {
>                     String modelName = file.toString().replace(ProjectConfiguration.PROJ_MODEL_DEFAULT_DIR, "");
475,476c441,444
< 
<                 models.put(modelName, fileEntry.getAbsolutePath());
---
>                     models.put(modelName, file.toString());
>                 }
>                 return FileVisitResult.CONTINUE;
>             }
